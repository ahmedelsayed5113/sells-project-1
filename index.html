<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PropFinder â€” Sales Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface2: #1a1a26;
    --border: #2a2a3a;
    --accent: #7c6dff;
    --accent2: #ff6d9e;
    --accent3: #6dffcb;
    --text: #e8e8f0;
    --muted: #6b6b80;
    --card: #16161f;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    top: -200px; left: -200px;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(124,109,255,0.08) 0%, transparent 70%);
    pointer-events: none;
    z-index: -1;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -200px; right: -200px;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(255,109,158,0.06) 0%, transparent 70%);
    pointer-events: none;
    z-index: -1;
  }

  .app {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 340px 1fr;
    grid-template-rows: auto 1fr;
    min-height: 100vh;
  }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 32px;
    border-bottom: 1px solid var(--border);
    background: rgba(10,10,15,0.8);
    backdrop-filter: blur(20px);
    position: sticky; top: 0; z-index: 100;
    gap: 16px;
  }

  .logo {
    display: flex; align-items: center; gap: 12px;
    flex-shrink: 0;
  }
  .logo-icon {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
  }
  .logo-text {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 20px;
    letter-spacing: -0.5px;
  }
  .logo-text span { color: var(--accent); }

  .header-stats {
    display: flex; gap: 32px;
  }
  .stat { text-align: center; }
  .stat-value {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 20px;
    color: var(--accent3);
  }
  .stat-label {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.8px;
  }

  .header-search {
    display: flex; align-items: center; gap: 10px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 16px;
    width: 280px;
    transition: border-color 0.2s;
    position: relative;
  }
  .header-search:focus-within { border-color: var(--accent); }
  .header-search input {
    background: none; border: none; outline: none;
    color: var(--text); font-family: 'DM Sans', sans-serif;
    font-size: 14px; width: 100%;
  }
  .header-search input::placeholder { color: var(--muted); }
  .search-clear {
    background: none; border: none; cursor: pointer;
    color: var(--muted); font-size: 16px; line-height: 1;
    opacity: 0; transition: opacity 0.2s;
    padding: 0;
  }
  .search-clear.visible { opacity: 1; }

  /* â”€â”€ HAMBURGER BUTTON (mobile only) â”€â”€ */
  .hamburger-btn {
    display: none;
    align-items: center; justify-content: center;
    width: 40px; height: 40px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    flex-shrink: 0;
    transition: border-color 0.2s;
    flex-direction: column;
    gap: 5px;
    padding: 10px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  .hamburger-btn:hover { border-color: var(--accent); }
  .hamburger-btn span {
    display: block;
    width: 18px; height: 2px;
    background: var(--text);
    border-radius: 2px;
    transition: all 0.3s;
  }
  .hamburger-btn.open span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
  .hamburger-btn.open span:nth-child(2) { opacity: 0; }
  .hamburger-btn.open span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }

  /* â”€â”€ SIDEBAR OVERLAY (mobile) â”€â”€ */
  .sidebar-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 199;
    backdrop-filter: blur(4px);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .sidebar-overlay.visible {
    opacity: 1;
  }

  /* â”€â”€ SIDEBAR â”€â”€ */
  .sidebar {
    border-right: 1px solid var(--border);
    padding: 20px;
    overflow-y: auto;
    max-height: calc(100vh - 77px);
    position: sticky; top: 77px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .sidebar-title {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--muted);
    margin-bottom: 16px;
    display: flex; align-items: center; gap: 8px;
  }
  .sidebar-title::after {
    content: ''; flex: 1;
    height: 1px; background: var(--border);
  }

  .filter-section {
    margin-bottom: 22px;
  }

  .filter-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 8px;
    display: flex; align-items: center; justify-content: space-between;
  }

  /* â”€â”€ PRICE / AREA WIDGETS â”€â”€ */
  .price-widget, .area-widget {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px;
    transition: border-color 0.2s;
  }
  .price-widget:focus-within,
  .area-widget:focus-within { border-color: rgba(124,109,255,0.4); }

  .presets {
    display: flex; flex-wrap: wrap; gap: 4px;
    margin-bottom: 12px;
  }
  .preset-chip {
    padding: 3px 9px;
    border-radius: 16px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    font-size: 11px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s;
    white-space: nowrap;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  .preset-chip:hover, .preset-chip.active {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(124,109,255,0.1);
  }

  .range-inputs {
    display: grid; grid-template-columns: 1fr auto 1fr; gap: 6px;
    align-items: center;
    margin-bottom: 12px;
  }
  .range-sep-arrow { color: var(--muted); font-size: 14px; text-align: center; }

  .range-manual-input { position: relative; }
  .range-manual-input label {
    position: absolute; top: -7px; left: 8px;
    font-size: 9px; color: var(--muted);
    background: var(--surface2); padding: 0 4px;
    text-transform: uppercase; letter-spacing: 0.5px;
    z-index: 1;
  }
  .range-manual-input input {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    padding: 8px 10px;
    outline: none;
    transition: border-color 0.2s;
    text-align: center;
  }
  .range-manual-input input:focus { border-color: var(--accent); }
  .range-manual-input .unit-hint {
    font-size: 10px; color: var(--muted);
    text-align: center; margin-top: 2px;
  }

  .slider-wrap {
    position: relative; height: 28px;
    margin-top: 4px;
  }
  .range-track-bg {
    position: absolute;
    top: 50%; transform: translateY(-50%);
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    width: 100%;
  }
  .range-fill {
    position: absolute;
    height: 4px;
    border-radius: 2px;
    top: 0;
  }
  .slider-wrap input[type=range] {
    position: absolute;
    width: 100%; height: 4px;
    background: transparent;
    pointer-events: none;
    -webkit-appearance: none;
    top: 50%; transform: translateY(-50%);
  }
  .slider-wrap input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px; height: 22px;
    border-radius: 50%;
    background: var(--accent);
    border: 3px solid var(--bg);
    cursor: pointer;
    pointer-events: all;
    box-shadow: 0 0 0 2px var(--accent);
    transition: transform 0.15s, box-shadow 0.15s;
  }
  .slider-wrap input[type=range]::-webkit-slider-thumb:hover {
    transform: scale(1.25);
    box-shadow: 0 0 0 4px rgba(124,109,255,0.3);
  }
  .slider-wrap input[type=range]::-webkit-slider-thumb:active {
    transform: scale(1.1);
  }

  .scale-markers {
    display: flex; justify-content: space-between;
    margin-top: 4px;
  }
  .scale-marker { font-size: 9px; color: var(--muted); }

  .single-range-wrap {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px;
  }
  .single-range-wrap .range-display {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 8px;
  }
  .range-val {
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    font-weight: 600;
  }
  .single-range-wrap input[type=range] {
    width: 100%;
    accent-color: var(--accent2);
    height: 4px;
    cursor: pointer;
  }

  .pill-group {
    display: flex; flex-wrap: wrap; gap: 5px;
  }
  .pill {
    padding: 5px 11px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: var(--surface2);
    color: var(--muted);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.18s;
    user-select: none;
    white-space: nowrap;
    /* Mobile touch target */
    min-height: 32px;
    display: flex; align-items: center;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  .pill:hover { border-color: var(--accent); color: var(--text); }
  .pill.active {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }
  .pill.active-green {
    background: var(--accent3);
    border-color: var(--accent3);
    color: #000;
  }

  .styled-select {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    padding: 10px 12px;
    outline: none;
    cursor: pointer;
    transition: border-color 0.2s;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b6b80' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 32px;
    min-height: 44px;
  }
  .styled-select:focus { border-color: var(--accent); }

  .number-inputs {
    display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
  }
  .number-input-wrap { position: relative; }
  .number-input-wrap input {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    padding: 10px 12px;
    outline: none;
    transition: border-color 0.2s;
    min-height: 44px;
  }
  .number-input-wrap input:focus { border-color: var(--accent); }
  .number-input-wrap label {
    position: absolute;
    top: -8px; left: 10px;
    font-size: 10px; color: var(--muted);
    background: var(--bg); padding: 0 4px;
    text-transform: uppercase; letter-spacing: 0.5px;
  }

  .btn-reset {
    width: 100%;
    padding: 12px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--muted);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 4px;
    min-height: 44px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  .btn-reset:hover {
    border-color: var(--accent2);
    color: var(--accent2);
  }

  .toggle-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 0;
    min-height: 44px;
  }
  .toggle-label { font-size: 13px; color: var(--text); }
  .toggle { position: relative; width: 44px; height: 26px; flex-shrink: 0; }
  .toggle input { opacity: 0; width: 0; height: 0; }
  .toggle-slider {
    position: absolute; inset: 0;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 26px; cursor: pointer;
    transition: all 0.2s;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  .toggle-slider::after {
    content: '';
    position: absolute;
    left: 3px; top: 50%; transform: translateY(-50%);
    width: 18px; height: 18px;
    background: var(--muted);
    border-radius: 50%;
    transition: all 0.2s;
  }
  .toggle input:checked + .toggle-slider { background: var(--accent); border-color: var(--accent); }
  .toggle input:checked + .toggle-slider::after { left: 23px; background: #fff; }

  /* â”€â”€ MAIN â”€â”€ */
  .main {
    padding: 24px;
    overflow-y: auto;
    max-height: calc(100vh - 77px);
  }

  .results-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 16px;
    flex-wrap: wrap; gap: 10px;
  }

  .results-count {
    font-family: 'Syne', sans-serif;
    font-size: 22px;
    font-weight: 700;
  }
  .results-count span { color: var(--accent); }

  .sort-controls {
    display: flex; gap: 6px; align-items: center; flex-wrap: wrap;
  }
  .sort-btn {
    padding: 7px 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--muted);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'DM Sans', sans-serif;
    min-height: 36px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  .sort-btn.active, .sort-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .active-filters {
    display: flex; flex-wrap: wrap; gap: 6px;
    margin-bottom: 14px;
    min-height: 0;
  }
  .filter-tag {
    display: flex; align-items: center; gap: 6px;
    background: rgba(124,109,255,0.15);
    border: 1px solid rgba(124,109,255,0.3);
    border-radius: 20px;
    padding: 4px 10px 4px 12px;
    font-size: 12px;
    color: var(--accent);
    animation: tagIn 0.2s ease;
  }
  @keyframes tagIn {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
  }
  .filter-tag button {
    background: none; border: none; cursor: pointer;
    color: var(--accent); font-size: 14px; line-height: 1;
    opacity: 0.7; transition: opacity 0.2s;
    padding: 0;
    min-width: 24px; min-height: 24px;
    display: flex; align-items: center; justify-content: center;
  }
  .filter-tag button:hover { opacity: 1; }

  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
    gap: 14px;
  }

  .unit-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 18px;
    transition: all 0.25s;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    animation: cardIn 0.3s ease both;
  }
  @keyframes cardIn {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .unit-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    opacity: 0;
    transition: opacity 0.25s;
  }
  .unit-card:hover {
    border-color: rgba(124,109,255,0.4);
    transform: translateY(-3px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.4);
  }
  .unit-card:hover::before { opacity: 1; }

  .card-header {
    display: flex; justify-content: space-between; align-items: flex-start;
    margin-bottom: 12px;
  }
  .compound-name {
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    font-weight: 700;
    line-height: 1.3;
    flex: 1;
  }
  .unit-type-badge {
    padding: 3px 9px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 500;
    background: rgba(109,255,203,0.12);
    color: var(--accent3);
    border: 1px solid rgba(109,255,203,0.2);
    white-space: nowrap;
    margin-left: 8px;
  }

  .card-meta {
    display: flex; flex-wrap: wrap; gap: 6px;
    margin-bottom: 14px;
  }
  .meta-chip {
    display: flex; align-items: center; gap: 4px;
    font-size: 11px; color: var(--muted);
    background: var(--surface2);
    border-radius: 6px;
    padding: 3px 7px;
  }
  .meta-chip strong { color: var(--text); font-weight: 500; }

  .card-price {
    border-top: 1px solid var(--border);
    padding-top: 12px;
    display: flex; justify-content: space-between; align-items: flex-end;
  }
  .price-main {
    font-family: 'Syne', sans-serif;
    font-size: 17px;
    font-weight: 700;
    color: var(--text);
  }
  .price-main small {
    font-size: 11px; font-weight: 400;
    color: var(--muted); font-family: 'DM Sans', sans-serif;
    display: block;
  }
  .price-psm {
    font-size: 12px;
    color: var(--accent);
    text-align: right;
  }
  .price-psm small { color: var(--muted); font-size: 10px; display: block; }

  .card-footer {
    display: flex; gap: 6px; margin-top: 10px;
  }
  .card-detail {
    flex: 1; font-size: 10px; color: var(--muted);
    background: var(--surface2); border-radius: 6px;
    padding: 5px 6px; text-align: center;
  }
  .card-detail strong {
    display: block; color: var(--text);
    font-size: 11px; margin-bottom: 1px;
  }

  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 80px 20px;
    color: var(--muted);
  }
  .empty-state .empty-icon { font-size: 48px; margin-bottom: 16px; }
  .empty-state h3 {
    font-family: 'Syne', sans-serif;
    font-size: 20px; color: var(--text); margin-bottom: 8px;
  }

  .loading {
    grid-column: 1 / -1;
    text-align: center; padding: 60px;
    color: var(--muted);
  }
  .spinner {
    width: 32px; height: 32px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 16px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MOBILE RESPONSIVE â€” Ø¨ÙŠØ£Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¨Ø³ (â‰¤ 768px)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  @media (max-width: 768px) {

    /* Grid: full width single column */
    .app {
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr;
    }

    /* Header: compact */
    header {
      padding: 12px 16px;
      gap: 10px;
      flex-wrap: nowrap;
    }

    .logo-text { font-size: 16px; }
    .logo-icon { width: 30px; height: 30px; font-size: 15px; }

    /* Hide desktop stats & search in header */
    .header-stats { display: none; }
    .header-search { display: none; }

    /* Show hamburger */
    .hamburger-btn { display: flex; }

    /* Show overlay when active */
    .sidebar-overlay { display: block; }

    /* Sidebar: slide in from left as drawer */
    .sidebar {
      position: fixed;
      top: 0; left: 0;
      width: 320px;
      max-width: 88vw;
      height: 100vh;
      max-height: 100vh;
      z-index: 200;
      border-right: 1px solid var(--border);
      background: var(--bg);
      transform: translateX(-100%);
      transition: transform 0.32s cubic-bezier(0.4, 0, 0.2, 1);
      padding-top: 20px;
    }
    .sidebar.open {
      transform: translateX(0);
    }

    /* Main takes full width */
    .main {
      padding: 16px;
      max-height: none;
      overflow-y: visible;
    }

    /* Mobile search bar below header */
    .mobile-search {
      display: flex;
    }

    /* Results header stacks */
    .results-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .results-count { font-size: 18px; }

    /* Sort buttons: horizontal scroll */
    .sort-controls {
      width: 100%;
      overflow-x: auto;
      flex-wrap: nowrap;
      padding-bottom: 4px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .sort-controls::-webkit-scrollbar { display: none; }
    .sort-btn {
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* Cards: single column on small, 2 cols if wide enough */
    .cards-grid {
      grid-template-columns: 1fr;
      gap: 12px;
    }

    /* Bigger touch targets for pills */
    .pill {
      padding: 7px 13px;
      font-size: 13px;
      min-height: 36px;
    }

    /* Preset chips slightly bigger */
    .preset-chip {
      padding: 5px 10px;
      font-size: 12px;
      min-height: 30px;
    }

    /* Range inputs: stack nicely */
    .range-inputs {
      grid-template-columns: 1fr auto 1fr;
      gap: 4px;
    }
    .range-manual-input input {
      font-size: 13px;
      padding: 9px 8px;
    }

    /* Slider thumbs: bigger for touch */
    .slider-wrap input[type=range]::-webkit-slider-thumb {
      width: 26px; height: 26px;
    }

    /* Filter tag remove button: bigger */
    .filter-tag button {
      min-width: 28px; min-height: 28px;
      font-size: 16px;
    }

    /* number inputs */
    .number-input-wrap input {
      font-size: 14px;
      padding: 11px 12px;
    }

    /* Close button inside sidebar */
    .sidebar-close-row {
      display: flex !important;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    /* Card footer: smaller font on mobile is fine */
    .card-footer { gap: 5px; }
    .card-detail { font-size: 9px; padding: 4px 4px; }
    .card-detail strong { font-size: 10px; }
  }

  @media (min-width: 480px) and (max-width: 768px) {
    .cards-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  /* â”€â”€ Mobile Search Bar (shown below header on mobile) â”€â”€ */
  .mobile-search {
    display: none;
    align-items: center; gap: 10px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 16px;
    margin: 0 16px 16px;
    transition: border-color 0.2s;
  }
  .mobile-search:focus-within { border-color: var(--accent); }
  .mobile-search input {
    background: none; border: none; outline: none;
    color: var(--text); font-family: 'DM Sans', sans-serif;
    font-size: 14px; flex: 1;
  }
  .mobile-search input::placeholder { color: var(--muted); }

  /* â”€â”€ Mobile Stats Bar (shown on mobile below header) â”€â”€ */
  .mobile-stats {
    display: none;
    gap: 0;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  .mobile-stats::-webkit-scrollbar { display: none; }
  .mobile-stats .stat {
    flex: 1;
    min-width: 80px;
    padding: 10px 12px;
    border-right: 1px solid var(--border);
    text-align: center;
  }
  .mobile-stats .stat:last-child { border-right: none; }
  .mobile-stats .stat-value { font-size: 15px; }
  .mobile-stats .stat-label { font-size: 9px; }

  @media (max-width: 768px) {
    .mobile-stats { display: flex; }
    .mobile-search { display: flex; }
  }

  /* â”€â”€ Sidebar close row (hidden on desktop) â”€â”€ */
  .sidebar-close-row {
    display: none;
  }
  .sidebar-close-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-size: 18px;
    cursor: pointer;
    width: 36px; height: 36px;
    display: flex; align-items: center; justify-content: center;
    transition: border-color 0.2s;
  }
  .sidebar-close-btn:hover { border-color: var(--accent2); }

  .filter-count-badge {
    background: var(--accent);
    color: #fff;
    font-size: 10px;
    font-weight: 700;
    border-radius: 10px;
    padding: 1px 6px;
    margin-left: 4px;
    display: none;
  }
  .filter-count-badge.visible { display: inline; }
</style>
</head>
<body>

<!-- Sidebar overlay (mobile) -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<div class="app">

  <!-- â•â•â• HEADER â•â•â• -->
  <header>
    <div class="logo">
      <div class="logo-icon">ğŸ™ï¸</div>
      <div class="logo-text">Prop<span>Finder</span></div>
    </div>

    <!-- Desktop stats -->
    <div class="header-stats">
      <div class="stat">
        <div class="stat-value" id="totalCount">â€”</div>
        <div class="stat-label">Total Units</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="filteredCount">â€”</div>
        <div class="stat-label">Matching</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="avgPrice">â€”</div>
        <div class="stat-label">Avg Price</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="compoundCount">â€”</div>
        <div class="stat-label">Compounds</div>
      </div>
    </div>

    <!-- Desktop search -->
    <div class="header-search">
      <span>ğŸ”</span>
      <input type="text" id="searchInput" placeholder="Compound, developer, area..." autocomplete="off">
      <button class="search-clear" id="searchClear">Ã—</button>
    </div>

    <!-- Hamburger (mobile only) -->
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle filters">
      <span></span><span></span><span></span>
      <span class="filter-count-badge" id="filterBadge">0</span>
    </button>
  </header>

  <!-- Mobile stats bar -->
  <div class="mobile-stats">
    <div class="stat">
      <div class="stat-value" id="totalCountMobile">â€”</div>
      <div class="stat-label">Total</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="filteredCountMobile">â€”</div>
      <div class="stat-label">Matching</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="avgPriceMobile">â€”</div>
      <div class="stat-label">Avg Price</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="compoundCountMobile">â€”</div>
      <div class="stat-label">Compounds</div>
    </div>
  </div>

  <!-- Mobile search bar -->
  <div class="mobile-search">
    <span>ğŸ”</span>
    <input type="text" id="searchInputMobile" placeholder="Compound, developer, area..." autocomplete="off">
    <button class="search-clear" id="searchClearMobile" style="opacity:0">Ã—</button>
  </div>

  <!-- â•â•â• SIDEBAR â•â•â• -->
  <aside class="sidebar" id="sidebar">

    <!-- Mobile close row -->
    <div class="sidebar-close-row">
      <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:15px;">Filters</div>
      <button class="sidebar-close-btn" id="sidebarCloseBtn">Ã—</button>
    </div>

    <div class="sidebar-title">Filters</div>

    <!-- CITY -->
    <div class="filter-section">
      <div class="filter-label">City</div>
      <div class="pill-group" id="cityFilter"></div>
    </div>

    <!-- UNIT TYPE -->
    <div class="filter-section">
      <div class="filter-label">Unit Type</div>
      <div class="pill-group" id="unitTypeFilter"></div>
    </div>

    <!-- BEDROOMS -->
    <div class="filter-section">
      <div class="filter-label">Bedrooms</div>
      <div class="pill-group" id="bedroomsFilter">
        <div class="pill active-green" data-bed="any">Any</div>
        <div class="pill" data-bed="1">1 BR</div>
        <div class="pill" data-bed="2">2 BR</div>
        <div class="pill" data-bed="3">3 BR</div>
        <div class="pill" data-bed="4">4 BR</div>
        <div class="pill" data-bed="5">5+ BR</div>
      </div>
    </div>

    <!-- TOTAL PRICE -->
    <div class="filter-section">
      <div class="filter-label">
        Total Price <span style="color:var(--accent3);font-size:9px;font-weight:400">EGP</span>
      </div>
      <div class="price-widget">
        <div class="presets" id="pricePresets">
          <button class="preset-chip" data-price-min="0" data-price-max="5000000" data-label="Under 5M">Under 5M</button>
          <button class="preset-chip" data-price-min="5000000" data-price-max="10000000" data-label="5Mâ€“10M">5Mâ€“10M</button>
          <button class="preset-chip" data-price-min="10000000" data-price-max="20000000" data-label="10Mâ€“20M">10Mâ€“20M</button>
          <button class="preset-chip" data-price-min="20000000" data-price-max="50000000" data-label="20Mâ€“50M">20Mâ€“50M</button>
          <button class="preset-chip" data-price-min="50000000" data-price-max="100000000" data-label="50Mâ€“100M">50Mâ€“100M</button>
          <button class="preset-chip" data-price-min="100000000" data-price-max="500000000" data-label="100Mâ€“500M">100Mâ€“500M</button>
          <button class="preset-chip" data-price-min="500000000" data-price-max="999000000000000" data-label="500M+">500M+</button>
        </div>
        <div class="range-inputs">
          <div class="range-manual-input">
            <label>Min</label>
            <input type="number" id="priceMinInput" placeholder="e.g. 3000000" min="0" step="500000">
            <div class="unit-hint" id="priceMinHint">â€”</div>
          </div>
          <div class="range-sep-arrow">â†’</div>
          <div class="range-manual-input">
            <label>Max</label>
            <input type="number" id="priceMaxInput" placeholder="e.g. 15000000" min="0" step="500000">
            <div class="unit-hint" id="priceMaxHint">â€”</div>
          </div>
        </div>
        <div class="slider-wrap">
          <div class="range-track-bg">
            <div class="range-fill" id="priceFill"
              style="background:linear-gradient(90deg,var(--accent),var(--accent2))"></div>
          </div>
          <input type="range" id="priceSliderMin" min="0" max="1000" value="0">
          <input type="range" id="priceSliderMax" min="0" max="1000" value="1000">
        </div>
        <div class="scale-markers">
          <span class="scale-marker">1M</span>
          <span class="scale-marker">5M</span>
          <span class="scale-marker">20M</span>
          <span class="scale-marker">100M</span>
          <span class="scale-marker">500M+</span>
        </div>
      </div>
    </div>

    <!-- AREA -->
    <div class="filter-section">
      <div class="filter-label">
        Built-Up Area <span style="color:var(--accent3);font-size:9px;font-weight:400">mÂ²</span>
      </div>
      <div class="area-widget">
        <div class="presets">
          <button class="preset-chip area-preset" data-min="0" data-max="80">Under 80</button>
          <button class="preset-chip area-preset" data-min="80" data-max="150">80â€“150</button>
          <button class="preset-chip area-preset" data-min="150" data-max="250">150â€“250</button>
          <button class="preset-chip area-preset" data-min="250" data-max="9999">250+</button>
        </div>
        <div class="range-inputs">
          <div class="range-manual-input">
            <label>Min mÂ²</label>
            <input type="number" id="areaMinInput" placeholder="e.g. 100" min="0" step="5">
          </div>
          <div class="range-sep-arrow">â†’</div>
          <div class="range-manual-input">
            <label>Max mÂ²</label>
            <input type="number" id="areaMaxInput" placeholder="e.g. 300" min="0" step="5">
          </div>
        </div>
        <div class="slider-wrap">
          <div class="range-track-bg">
            <div class="range-fill" id="areaFill"
              style="background:linear-gradient(90deg,var(--accent3),var(--accent))"></div>
          </div>
          <input type="range" id="areaSliderMin" min="0" max="1000" value="0">
          <input type="range" id="areaSliderMax" min="0" max="1000" value="1000">
        </div>
      </div>
    </div>

    <!-- PRICE PER SQM -->
    <div class="filter-section">
      <div class="filter-label">
        Price / mÂ² <span style="color:var(--accent3);font-size:9px;font-weight:400">EGP</span>
      </div>
      <div class="area-widget">
        <div class="presets">
          <button class="preset-chip psm-preset" data-min="0" data-max="50000">Under 50K</button>
          <button class="preset-chip psm-preset" data-min="50000" data-max="100000">50Kâ€“100K</button>
          <button class="preset-chip psm-preset" data-min="100000" data-max="200000">100Kâ€“200K</button>
          <button class="preset-chip psm-preset" data-min="200000" data-max="9999999">200K+</button>
        </div>
        <div class="range-inputs">
          <div class="range-manual-input">
            <label>Min EGP/mÂ²</label>
            <input type="number" id="psmMinInput" placeholder="e.g. 50000" min="0" step="5000">
          </div>
          <div class="range-sep-arrow">â†’</div>
          <div class="range-manual-input">
            <label>Max EGP/mÂ²</label>
            <input type="number" id="psmMaxInput" placeholder="e.g. 200000" min="0" step="5000">
          </div>
        </div>
        <div class="slider-wrap">
          <div class="range-track-bg">
            <div class="range-fill" id="psmFill"
              style="background:linear-gradient(90deg,var(--accent2),var(--accent))"></div>
          </div>
          <input type="range" id="psmSliderMin" min="0" max="1000" value="0">
          <input type="range" id="psmSliderMax" min="0" max="1000" value="1000">
        </div>
      </div>
    </div>

    <!-- DELIVERY -->
    <div class="filter-section">
      <div class="filter-label">Delivery (months from now)</div>
      <div class="presets" id="deliveryPresets" style="margin-bottom:8px">
        <button class="preset-chip delivery-preset" data-from="0" data-to="6">Ready</button>
        <button class="preset-chip delivery-preset" data-from="0" data-to="12">Within 1yr</button>
        <button class="preset-chip delivery-preset" data-from="0" data-to="24">Within 2yr</button>
        <button class="preset-chip delivery-preset" data-from="0" data-to="36">Within 3yr</button>
      </div>
      <div class="number-inputs">
        <div class="number-input-wrap">
          <label>From</label>
          <input type="number" id="deliveryFrom" placeholder="e.g. 6">
        </div>
        <div class="number-input-wrap">
          <label>To</label>
          <input type="number" id="deliveryTo" placeholder="e.g. 24">
        </div>
      </div>
    </div>

    <!-- DEVELOPER -->
    <div class="filter-section">
      <div class="filter-label">Developer</div>
      <select class="styled-select" id="developerFilter">
        <option value="">All Developers</option>
      </select>
    </div>

    <!-- FINISHING -->
    <div class="filter-section">
      <div class="filter-label">Finishing Type</div>
      <div class="pill-group" id="finishingFilter"></div>
    </div>

    <!-- CASH DISCOUNT -->
    <div class="filter-section">
      <div class="filter-label">Min Cash Discount</div>
      <div class="single-range-wrap">
        <div class="range-display">
          <span class="range-val" id="discountVal" style="color:var(--accent2)">0%</span>
          <span style="font-size:11px;color:var(--muted)">minimum</span>
        </div>
        <input type="range" id="discountSlider" min="0" max="40" value="0">
      </div>
    </div>

    <!-- OPTIONS -->
    <div class="filter-section">
      <div class="filter-label">Options</div>
      <div class="toggle-row">
        <span class="toggle-label">Free Club Fees</span>
        <label class="toggle">
          <input type="checkbox" id="freeClub">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Free Parking</span>
        <label class="toggle">
          <input type="checkbox" id="freeParking">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Hide Sold Units</span>
        <label class="toggle">
          <input type="checkbox" id="hideSold">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>

    <button class="btn-reset" id="resetBtn">â†º Reset All Filters</button>
    <!-- Extra padding at bottom for mobile scroll -->
    <div style="height: 40px;"></div>
  </aside>

  <!-- â•â•â• MAIN â•â•â• -->
  <main class="main">
    <div class="results-header">
      <div class="results-count">
        <span id="resultNum">â€”</span> units found
      </div>
      <div class="sort-controls">
        <span style="font-size:12px;color:var(--muted);white-space:nowrap">Sort:</span>
        <button class="sort-btn active" data-sort="price_asc">Price â†‘</button>
        <button class="sort-btn" data-sort="price_desc">Price â†“</button>
        <button class="sort-btn" data-sort="area_desc">Area â†“</button>
        <button class="sort-btn" data-sort="psm_asc">PSM â†‘</button>
        <button class="sort-btn" data-sort="discount_desc">Discount â†“</button>
        <button class="sort-btn" data-sort="delivery_asc">Delivery â†‘</button>
      </div>
    </div>

    <div class="active-filters" id="activeTags"></div>

    <div class="cards-grid" id="cardsGrid">
      <div class="loading">
        <div class="spinner"></div>
        Loading units data...
      </div>
    </div>
  </main>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOBILE SIDEBAR CONTROLS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  sidebar.classList.contains('open') ? closeSidebar() : openSidebar();
}
function openSidebar() {
  document.getElementById('sidebar').classList.add('open');
  document.getElementById('sidebarOverlay').classList.add('visible');
  document.getElementById('hamburgerBtn').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('visible');
  document.getElementById('hamburgerBtn').classList.remove('open');
  document.body.style.overflow = '';
}
window.addEventListener('resize', () => { if (window.innerWidth > 768) closeSidebar(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCALE CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PRICE_LOG_MIN = 6, PRICE_LOG_MAX = 8.699;
const AREA_LINEAR_MAX = 1000;
const PSM_LOG_MIN = 4, PSM_LOG_MAX = 6.3;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let allData = [], filteredData = [], sortMode = 'price_asc', currentBatchEnd = 50;
const rangeState = { priceMin:null, priceMax:null, areaMin:null, areaMax:null, psmMin:null, psmMax:null };
const activeFilters = { cities: new Set(), unitTypes: new Set(), bedrooms: 'any', finishing: new Set() };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const sliderToPrice = v => Math.round(Math.pow(10, PRICE_LOG_MIN + (v/1000)*(PRICE_LOG_MAX-PRICE_LOG_MIN)));
const priceToSlider = p => { if(!p||p<=0)return 0; return Math.round(Math.max(0,Math.min(1000,((Math.log10(p)-PRICE_LOG_MIN)/(PRICE_LOG_MAX-PRICE_LOG_MIN))*1000))); };
const sliderToPsm   = v => Math.round(Math.pow(10, PSM_LOG_MIN + (v/1000)*(PSM_LOG_MAX-PSM_LOG_MIN)));
const psmToSlider   = p => { if(!p||p<=0)return 0; return Math.round(Math.max(0,Math.min(1000,((Math.log10(p)-PSM_LOG_MIN)/(PSM_LOG_MAX-PSM_LOG_MIN))*1000))); };
const sliderToArea  = v => Math.round((v/1000)*AREA_LINEAR_MAX);
const areaToSlider  = a => Math.round((a/AREA_LINEAR_MAX)*1000);

function fmtNum(n) { return n?.toLocaleString('en-US')?? '0'; }
function fmtMillion(n) {
  if(!n||n===0)return '0';
  if(n>=1e9) return (n/1e9).toFixed(2).replace(/\.?0+$/,'')+' B';
  if(n>=1e6) return (n/1e6).toFixed(2).replace(/\.?0+$/,'')+' M';
  if(n>=1e3) return (n/1e3).toFixed(0)+'K';
  return fmtNum(Math.round(n));
}

function syncFill(fillId, minId, maxId) {
  const fill=document.getElementById(fillId), minS=document.getElementById(minId), maxS=document.getElementById(maxId);
  if(!fill||!minS||!maxS)return;
  fill.style.left=(parseInt(minS.value)/10)+'%';
  fill.style.width=((parseInt(maxS.value)-parseInt(minS.value))/10)+'%';
}

function g(id) { return document.getElementById(id); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRICE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onPriceSliderChange() {
  const minS=g('priceSliderMin'), maxS=g('priceSliderMax');
  if(parseInt(minS.value)>parseInt(maxS.value)) minS.value=maxS.value;
  const minVal=sliderToPrice(parseInt(minS.value)), maxVal=sliderToPrice(parseInt(maxS.value));
  rangeState.priceMin=parseInt(minS.value)===0?null:minVal;
  rangeState.priceMax=parseInt(maxS.value)===1000?null:maxVal;
  g('priceMinInput').value=rangeState.priceMin||'';
  g('priceMaxInput').value=rangeState.priceMax||'';
  g('priceMinHint').textContent=rangeState.priceMin?fmtMillion(minVal):'â€”';
  g('priceMaxHint').textContent=rangeState.priceMax?fmtMillion(maxVal):'â€”';
  clearPresets('pricePresets');
  syncFill('priceFill','priceSliderMin','priceSliderMax');
  applyFilters();
}
function onPriceInputChange() {
  const minRaw=parseFloat(g('priceMinInput').value), maxRaw=parseFloat(g('priceMaxInput').value);
  rangeState.priceMin=isNaN(minRaw)||minRaw<=0?null:minRaw;
  rangeState.priceMax=isNaN(maxRaw)||maxRaw<=0?null:maxRaw;
  g('priceMinHint').textContent=rangeState.priceMin?fmtMillion(rangeState.priceMin):'â€”';
  g('priceMaxHint').textContent=rangeState.priceMax?fmtMillion(rangeState.priceMax):'â€”';
  g('priceSliderMin').value=rangeState.priceMin?priceToSlider(rangeState.priceMin):0;
  g('priceSliderMax').value=rangeState.priceMax?priceToSlider(rangeState.priceMax):1000;
  clearPresets('pricePresets');
  syncFill('priceFill','priceSliderMin','priceSliderMax');
  applyFilters();
}
function setPricePreset(min, max, label) {
  rangeState.priceMin=min>0?min:null;
  rangeState.priceMax=max>=999e9?null:max;
  g('priceMinInput').value=min>0?min:'';
  g('priceMaxInput').value=max>=999e9?'':max;
  g('priceMinHint').textContent=min>0?fmtMillion(min):'â€”';
  g('priceMaxHint').textContent=(max&&max<999e9)?fmtMillion(max):'â€”';
  g('priceSliderMin').value=min>0?priceToSlider(min):0;
  g('priceSliderMax').value=(max&&max<999e9)?priceToSlider(max):1000;
  syncFill('priceFill','priceSliderMin','priceSliderMax');
  highlightPreset('pricePresets',label);
  applyFilters();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AREA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onAreaSliderChange() {
  const minS=g('areaSliderMin'), maxS=g('areaSliderMax');
  if(parseInt(minS.value)>parseInt(maxS.value)) minS.value=maxS.value;
  const minVal=sliderToArea(parseInt(minS.value)), maxVal=sliderToArea(parseInt(maxS.value));
  rangeState.areaMin=parseInt(minS.value)===0?null:minVal;
  rangeState.areaMax=parseInt(maxS.value)===1000?null:maxVal;
  g('areaMinInput').value=rangeState.areaMin||'';
  g('areaMaxInput').value=rangeState.areaMax||'';
  syncFill('areaFill','areaSliderMin','areaSliderMax');
  applyFilters();
}
function onAreaInputChange() {
  const minRaw=parseFloat(g('areaMinInput').value), maxRaw=parseFloat(g('areaMaxInput').value);
  rangeState.areaMin=isNaN(minRaw)||minRaw<=0?null:minRaw;
  rangeState.areaMax=isNaN(maxRaw)||maxRaw<=0?null:maxRaw;
  g('areaSliderMin').value=rangeState.areaMin?areaToSlider(rangeState.areaMin):0;
  g('areaSliderMax').value=rangeState.areaMax?areaToSlider(rangeState.areaMax):1000;
  syncFill('areaFill','areaSliderMin','areaSliderMax');
  applyFilters();
}
function setAreaPreset(min, max) {
  rangeState.areaMin=min>0?min:null;
  rangeState.areaMax=max>=9999?null:max;
  g('areaMinInput').value=min>0?min:'';
  g('areaMaxInput').value=max>=9999?'':max;
  g('areaSliderMin').value=min>0?areaToSlider(min):0;
  g('areaSliderMax').value=(max&&max<9999)?areaToSlider(max):1000;
  syncFill('areaFill','areaSliderMin','areaSliderMax');
  applyFilters();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PSM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onPsmSliderChange() {
  const minS=g('psmSliderMin'), maxS=g('psmSliderMax');
  if(parseInt(minS.value)>parseInt(maxS.value)) minS.value=maxS.value;
  const minVal=sliderToPsm(parseInt(minS.value)), maxVal=sliderToPsm(parseInt(maxS.value));
  rangeState.psmMin=parseInt(minS.value)===0?null:minVal;
  rangeState.psmMax=parseInt(maxS.value)===1000?null:maxVal;
  g('psmMinInput').value=rangeState.psmMin||'';
  g('psmMaxInput').value=rangeState.psmMax||'';
  syncFill('psmFill','psmSliderMin','psmSliderMax');
  applyFilters();
}
function onPsmInputChange() {
  const minRaw=parseFloat(g('psmMinInput').value), maxRaw=parseFloat(g('psmMaxInput').value);
  rangeState.psmMin=isNaN(minRaw)||minRaw<=0?null:minRaw;
  rangeState.psmMax=isNaN(maxRaw)||maxRaw<=0?null:maxRaw;
  g('psmSliderMin').value=rangeState.psmMin?psmToSlider(rangeState.psmMin):0;
  g('psmSliderMax').value=rangeState.psmMax?psmToSlider(rangeState.psmMax):1000;
  syncFill('psmFill','psmSliderMin','psmSliderMax');
  applyFilters();
}
function setPsmPreset(min, max) {
  rangeState.psmMin=min>0?min:null;
  rangeState.psmMax=max>=9999999?null:max;
  g('psmMinInput').value=min>0?min:'';
  g('psmMaxInput').value=max>=9999999?'':max;
  g('psmSliderMin').value=min>0?psmToSlider(min):0;
  g('psmSliderMax').value=(max&&max<9999999)?psmToSlider(max):1000;
  syncFill('psmFill','psmSliderMin','psmSliderMax');
  applyFilters();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DELIVERY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setDelivery(el, from, to) {
  g('deliveryFrom').value=from;
  g('deliveryTo').value=to;
  document.querySelectorAll('.delivery-preset').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  applyFilters();
}
function clearDeliveryPresets() {
  document.querySelectorAll('.delivery-preset').forEach(c=>c.classList.remove('active'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRESET HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function highlightPreset(containerId, label) {
  document.querySelectorAll(`#${containerId} .preset-chip`).forEach(c=>{
    c.classList.toggle('active', c.textContent.trim()===label);
  });
}
function clearPresets(containerId) {
  document.querySelectorAll(`#${containerId} .preset-chip`).forEach(c=>c.classList.remove('active'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BEDROOMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function filterBed(el, val) {
  document.querySelectorAll('#bedroomsFilter .pill').forEach(p=>p.classList.remove('active','active-green'));
  el.classList.add(val==='any'?'active-green':'active');
  activeFilters.bedrooms=val;
  applyFilters();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setSort(mode, el) {
  sortMode=mode;
  document.querySelectorAll('.sort-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  applyFilters();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEARCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function clearSearch() { g('searchInput').value=''; g('searchClear').classList.remove('visible'); applyFilters(); }
function clearSearchMobile() { g('searchInputMobile').value=''; g('searchClearMobile').style.opacity='0'; applyFilters(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTER BADGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateFilterBadge() {
  let count=0;
  count+=activeFilters.cities.size+activeFilters.unitTypes.size+activeFilters.finishing.size;
  if(activeFilters.bedrooms!=='any')count++;
  if(rangeState.priceMin!==null||rangeState.priceMax!==null)count++;
  if(rangeState.areaMin!==null||rangeState.areaMax!==null)count++;
  if(rangeState.psmMin!==null||rangeState.psmMax!==null)count++;
  if(parseInt(g('discountSlider').value)>0)count++;
  if(g('freeClub').checked)count++;
  if(g('freeParking').checked)count++;
  if(g('hideSold').checked)count++;
  if(g('developerFilter').value)count++;
  if(g('deliveryFrom').value||g('deliveryTo').value)count++;
  const badge=g('filterBadge');
  if(count>0){ badge.textContent=count; badge.classList.add('visible'); }
  else badge.classList.remove('visible');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadData() {
  const grid=g('cardsGrid');
  grid.innerHTML='<div class="loading"><div class="spinner"></div>Loading units data...</div>';
  try {
    const resp=await fetch('/api/units');
    if(!resp.ok)throw new Error(`HTTP ${resp.status}: ${resp.statusText}`);
    const data=await resp.json();
    if(data.error)throw new Error(data.error);
    allData=data;
  } catch(e) {
    grid.innerHTML=`<div class="empty-state"><div class="empty-icon">âš ï¸</div><h3>Failed to load data</h3><p>${e.message}</p><button class="btn-reset" id="retryBtn" style="width:auto;margin-top:16px">ğŸ”„ Retry</button></div>`;
    g('retryBtn')?.addEventListener('click', loadData);
    return;
  }
  initPage();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initPage() {
  if(!allData.length) {
    g('cardsGrid').innerHTML='<div class="empty-state"><div class="empty-icon">âš ï¸</div><h3>No data available</h3><p>Check database connection or run sync job</p></div>';
    return;
  }
  buildPills('cityFilter',     [...new Set(allData.map(d=>d.city_name))].sort(),                     'city');
  buildPills('unitTypeFilter', [...new Set(allData.map(d=>d.unit_type))].sort(),                     'type');
  buildPills('finishingFilter',[...new Set(allData.map(d=>d.finishing_type).filter(Boolean))].sort(),'finishing');
  const devSelect=g('developerFilter');
  [...new Set(allData.map(d=>d.developer_name))].sort().forEach(dev=>{
    const opt=document.createElement('option'); opt.value=dev; opt.textContent=dev; devSelect.appendChild(opt);
  });
  const total=fmtNum(allData.length), compounds=new Set(allData.map(d=>d.compound_name)).size;
  g('totalCount').textContent=g('totalCountMobile').textContent=total;
  g('compoundCount').textContent=g('compoundCountMobile').textContent=compounds;
  syncFill('priceFill','priceSliderMin','priceSliderMax');
  syncFill('areaFill','areaSliderMin','areaSliderMax');
  syncFill('psmFill','psmSliderMin','psmSliderMax');
  applyFilters();
}

function buildPills(containerId, values, type) {
  const el=g(containerId);
  const anyPill=document.createElement('div');
  anyPill.className='pill active-green'; anyPill.textContent='All';
  anyPill.addEventListener('click', ()=>{
    const set=type==='city'?activeFilters.cities:type==='type'?activeFilters.unitTypes:activeFilters.finishing;
    set.clear();
    el.querySelectorAll('.pill').forEach(p=>p.classList.remove('active'));
    anyPill.classList.add('active-green');
    applyFilters();
  });
  el.appendChild(anyPill);
  values.forEach(val=>{
    const pill=document.createElement('div');
    pill.className='pill'; pill.textContent=val;
    pill.addEventListener('click', ()=>{
      anyPill.classList.remove('active-green');
      const set=type==='city'?activeFilters.cities:type==='type'?activeFilters.unitTypes:activeFilters.finishing;
      if(set.has(val)){ set.delete(val); pill.classList.remove('active'); }
      else { set.add(val); pill.classList.add('active'); }
      if(!set.size) anyPill.classList.add('active-green');
      applyFilters();
    });
    el.appendChild(pill);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyFilters() {
  const desktopSearch=g('searchInput').value.toLowerCase().trim();
  const mobileSearch=g('searchInputMobile').value.toLowerCase().trim();
  const search=desktopSearch||mobileSearch;
  const delivFrom=parseFloat(g('deliveryFrom').value)||0;
  const delivTo=parseFloat(g('deliveryTo').value)||9999;
  const devFilter=g('developerFilter').value;
  const discount=parseInt(g('discountSlider').value)||0;
  const freeClub=g('freeClub').checked;
  const freePark=g('freeParking').checked;
  const hideSold=g('hideSold').checked;

  g('searchClear').classList.toggle('visible',desktopSearch.length>0);
  g('searchClearMobile').style.opacity=mobileSearch.length>0?'1':'0';

  filteredData=allData.filter(u=>{
    if(hideSold&&(u.is_sold||u.status===0))return false;
    if(activeFilters.cities.size&&!activeFilters.cities.has(u.city_name))return false;
    if(activeFilters.unitTypes.size&&!activeFilters.unitTypes.has(u.unit_type))return false;
    if(activeFilters.finishing.size&&!activeFilters.finishing.has(u.finishing_type))return false;
    if(activeFilters.bedrooms!=='any'){
      const b=parseInt(activeFilters.bedrooms);
      if(b===5){if(u.bedrooms<5)return false;}
      else{if(u.bedrooms!==b)return false;}
    }
    if(rangeState.priceMin!==null&&u.total_price_egp<rangeState.priceMin)return false;
    if(rangeState.priceMax!==null&&u.total_price_egp>rangeState.priceMax)return false;
    if(rangeState.areaMin!==null&&u.built_up_area_sqm<rangeState.areaMin)return false;
    if(rangeState.areaMax!==null&&u.built_up_area_sqm>rangeState.areaMax)return false;
    if(rangeState.psmMin!==null&&u.price_per_sqm_egp<rangeState.psmMin)return false;
    if(rangeState.psmMax!==null&&u.price_per_sqm_egp>rangeState.psmMax)return false;
    if(u.delivery_from_months<delivFrom||u.delivery_to_months>delivTo)return false;
    if(devFilter&&u.developer_name!==devFilter)return false;
    if(discount&&(u.cash_discount_percent||0)<discount)return false;
    if(freeClub&&u.club_fees?.toLowerCase()!=='free')return false;
    if(freePark&&u.parking_fees?.toLowerCase()!=='free')return false;
    if(search){
      const hay=`${u.compound_name} ${u.developer_name} ${u.city_name} ${u.unit_type} ${u.finishing_type||''}`.toLowerCase();
      if(!hay.includes(search))return false;
    }
    return true;
  });

  filteredData.sort((a,b)=>{
    if(sortMode==='price_asc')    return a.total_price_egp-b.total_price_egp;
    if(sortMode==='price_desc')   return b.total_price_egp-a.total_price_egp;
    if(sortMode==='area_desc')    return b.built_up_area_sqm-a.built_up_area_sqm;
    if(sortMode==='psm_asc')      return a.price_per_sqm_egp-b.price_per_sqm_egp;
    if(sortMode==='discount_desc')return (b.cash_discount_percent||0)-(a.cash_discount_percent||0);
    if(sortMode==='delivery_asc') return a.delivery_from_months-b.delivery_from_months;
    return 0;
  });

  currentBatchEnd=50;
  renderCards();
  updateStats();
  updateTags();
  updateFilterBadge();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCards() {
  const grid=g('cardsGrid');
  g('resultNum').textContent=fmtNum(filteredData.length);
  if(!filteredData.length){
    grid.innerHTML=`<div class="empty-state"><div class="empty-icon">ğŸ”</div><h3>No units found</h3><p>Try adjusting your filters</p><button class="btn-reset" id="clearFiltersBtn" style="width:auto;margin-top:16px">Clear Filters</button></div>`;
    g('clearFiltersBtn')?.addEventListener('click', resetFilters);
    return;
  }
  grid.innerHTML=filteredData.slice(0,50).map((u,i)=>renderCard(u,i)).join('');
  if(filteredData.length>50){
    const rem=filteredData.length-50;
    grid.innerHTML+=`<div class="empty-state" id="loadMoreCard" style="background:var(--surface2);border-radius:16px;border:1px dashed var(--border)"><div style="font-size:24px">ğŸ“¦</div><h3 style="font-size:16px">${fmtNum(rem)} more units</h3><button class="btn-reset" id="loadMoreBtn" style="width:auto;margin-top:12px">Show More</button></div>`;
    g('loadMoreBtn')?.addEventListener('click', loadMoreUnits);
  }
}

function renderCard(u,i) {
  return `<div class="unit-card" style="animation-delay:${(i%50)*0.02}s">
    <div class="card-header">
      <div class="compound-name">${u.compound_name}</div>
      <div class="unit-type-badge">${u.unit_type}</div>
    </div>
    <div class="card-meta">
      <div class="meta-chip">ğŸ“ <strong>${u.city_name}</strong></div>
      <div class="meta-chip">ğŸ—ï¸ <strong>${u.developer_name}</strong></div>
      <div class="meta-chip">ğŸ›ï¸ <strong>${u.bedrooms} BR</strong></div>
      <div class="meta-chip">ğŸ“ <strong>${u.built_up_area_sqm} mÂ²</strong></div>
      ${u.outdoor_area&&u.outdoor_area!=='0'?`<div class="meta-chip">ğŸŒ¿ <strong>${u.outdoor_area}</strong></div>`:''}
      ${u.finishing_type?`<div class="meta-chip">ğŸ¨ <strong>${u.finishing_type}</strong></div>`:''}
    </div>
    <div class="card-price">
      <div class="price-main"><small>Total Price</small>${fmtMillion(u.total_price_egp)} EGP</div>
      <div class="price-psm">${fmtNum(Math.round(u.price_per_sqm_egp))} EGP/mÂ²<small>per sqm</small></div>
    </div>
    <div class="card-footer">
      <div class="card-detail"><strong>${u.cash_price_from_egp?fmtMillion(u.cash_price_from_egp):'â€”'}</strong>Cash Price</div>
      <div class="card-detail"><strong>${u.cash_discount_percent||0}%</strong>Discount</div>
      <div class="card-detail"><strong>${u.delivery_from_months}â€“${u.delivery_to_months}mo</strong>Delivery</div>
      <div class="card-detail"><strong>${u.club_fees==='Free'?'âœ“ Free':(u.club_fees||'â€”')}</strong>Club</div>
    </div>
    ${u.payment_plan?`<div style="margin-top:10px;font-size:11px;color:var(--muted);border-top:1px solid var(--border);padding-top:8px">ğŸ’³ ${u.payment_plan}</div>`:''}
  </div>`;
}

function loadMoreUnits() {
  const grid=g('cardsGrid');
  g('loadMoreCard')?.remove();
  filteredData.slice(currentBatchEnd,currentBatchEnd+50).forEach((u,i)=>{
    grid.insertAdjacentHTML('beforeend',renderCard(u,i));
  });
  currentBatchEnd+=50;
  if(currentBatchEnd<filteredData.length){
    const rem=filteredData.length-currentBatchEnd;
    grid.insertAdjacentHTML('beforeend',`<div class="empty-state" id="loadMoreCard" style="background:var(--surface2);border-radius:16px;border:1px dashed var(--border)"><div style="font-size:24px">ğŸ“¦</div><h3 style="font-size:16px">${fmtNum(rem)} more units</h3><button class="btn-reset" id="loadMoreBtn" style="width:auto;margin-top:12px">Show More</button></div>`);
    g('loadMoreBtn')?.addEventListener('click',loadMoreUnits);
  }
}

function updateStats() {
  const prices=filteredData.map(d=>d.total_price_egp).filter(Boolean);
  const avg=prices.length?prices.reduce((a,b)=>a+b,0)/prices.length:0;
  const filtered=fmtNum(filteredData.length), avgFmt=avg?fmtMillion(avg):'â€”';
  g('filteredCount').textContent=g('filteredCountMobile').textContent=filtered;
  g('avgPrice').textContent=g('avgPriceMobile').textContent=avgFmt;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTIVE FILTER TAGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateTags() {
  const tags=[];
  [...activeFilters.cities].forEach(c=>tags.push({label:`ğŸ“ ${c}`,clear:()=>{activeFilters.cities.delete(c);applyFilters();}}));
  [...activeFilters.unitTypes].forEach(t=>tags.push({label:`ğŸ  ${t}`,clear:()=>{activeFilters.unitTypes.delete(t);applyFilters();}}));
  [...activeFilters.finishing].forEach(f=>tags.push({label:`ğŸ¨ ${f}`,clear:()=>{activeFilters.finishing.delete(f);applyFilters();}}));
  if(activeFilters.bedrooms!=='any')tags.push({label:`ğŸ›ï¸ ${activeFilters.bedrooms}+ BR`,clear:()=>{activeFilters.bedrooms='any';document.querySelectorAll('#bedroomsFilter .pill').forEach(p=>p.classList.remove('active'));document.querySelector('#bedroomsFilter .pill').classList.add('active-green');applyFilters();}});
  if(rangeState.priceMin!==null||rangeState.priceMax!==null)tags.push({label:`ğŸ’° ${rangeState.priceMin?fmtMillion(rangeState.priceMin):'0'} â†’ ${rangeState.priceMax?fmtMillion(rangeState.priceMax):'âˆ'}`,clear:()=>{rangeState.priceMin=null;rangeState.priceMax=null;['priceMinInput','priceMaxInput'].forEach(id=>g(id).value='');g('priceMinHint').textContent='â€”';g('priceMaxHint').textContent='â€”';g('priceSliderMin').value=0;g('priceSliderMax').value=1000;syncFill('priceFill','priceSliderMin','priceSliderMax');clearPresets('pricePresets');applyFilters();}});
  if(rangeState.areaMin!==null||rangeState.areaMax!==null)tags.push({label:`ğŸ“ ${rangeState.areaMin||0}mÂ² â†’ ${rangeState.areaMax?rangeState.areaMax+'mÂ²':'âˆ'}`,clear:()=>{rangeState.areaMin=null;rangeState.areaMax=null;['areaMinInput','areaMaxInput'].forEach(id=>g(id).value='');g('areaSliderMin').value=0;g('areaSliderMax').value=1000;syncFill('areaFill','areaSliderMin','areaSliderMax');applyFilters();}});
  if(rangeState.psmMin!==null||rangeState.psmMax!==null)tags.push({label:`ğŸ“Š ${rangeState.psmMin?fmtMillion(rangeState.psmMin):'0'}/mÂ² â†’ ${rangeState.psmMax?fmtMillion(rangeState.psmMax)+'/mÂ²':'âˆ'}`,clear:()=>{rangeState.psmMin=null;rangeState.psmMax=null;['psmMinInput','psmMaxInput'].forEach(id=>g(id).value='');g('psmSliderMin').value=0;g('psmSliderMax').value=1000;syncFill('psmFill','psmSliderMin','psmSliderMax');applyFilters();}});
  if(parseInt(g('discountSlider').value)>0)tags.push({label:`ğŸ¯ Min ${g('discountSlider').value}% off`,clear:()=>{g('discountSlider').value=0;g('discountVal').textContent='0%';applyFilters();}});
  if(g('freeClub').checked)tags.push({label:'ğŸŠ Free Club',clear:()=>{g('freeClub').checked=false;applyFilters();}});
  if(g('freeParking').checked)tags.push({label:'ğŸš— Free Parking',clear:()=>{g('freeParking').checked=false;applyFilters();}});
  if(g('developerFilter').value)tags.push({label:`ğŸ—ï¸ ${g('developerFilter').value}`,clear:()=>{g('developerFilter').value='';applyFilters();}});
  const dFrom=g('deliveryFrom').value, dTo=g('deliveryTo').value;
  if(dFrom||dTo)tags.push({label:`ğŸ“… Delivery ${dFrom||0}â€“${dTo||'âˆ'} mo`,clear:()=>{g('deliveryFrom').value='';g('deliveryTo').value='';clearDeliveryPresets();applyFilters();}});
  if(g('hideSold').checked)tags.push({label:'ğŸš« Hiding Sold',clear:()=>{g('hideSold').checked=false;applyFilters();}});

  const container=g('activeTags');
  container.innerHTML=tags.map((t,i)=>`<div class="filter-tag">${t.label}<button data-tag="${i}">Ã—</button></div>`).join('');
  window._tagClears=tags.map(t=>t.clear);
  container.querySelectorAll('button[data-tag]').forEach(btn=>{
    btn.addEventListener('click',()=>window._tagClears[parseInt(btn.dataset.tag)]());
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetFilters() {
  activeFilters.cities.clear(); activeFilters.unitTypes.clear(); activeFilters.finishing.clear(); activeFilters.bedrooms='any';
  Object.assign(rangeState,{priceMin:null,priceMax:null,areaMin:null,areaMax:null,psmMin:null,psmMax:null});
  ['priceMinInput','priceMaxInput','areaMinInput','areaMaxInput','psmMinInput','psmMaxInput'].forEach(id=>g(id).value='');
  ['priceMinHint','priceMaxHint'].forEach(id=>{const el=g(id);if(el)el.textContent='â€”';});
  ['priceSliderMin','priceSliderMax','areaSliderMin','areaSliderMax','psmSliderMin','psmSliderMax'].forEach(id=>g(id).value=id.includes('Min')?0:1000);
  syncFill('priceFill','priceSliderMin','priceSliderMax');
  syncFill('areaFill','areaSliderMin','areaSliderMax');
  syncFill('psmFill','psmSliderMin','psmSliderMax');
  document.querySelectorAll('.preset-chip').forEach(c=>c.classList.remove('active'));
  g('discountSlider').value=0; g('discountVal').textContent='0%';
  g('deliveryFrom').value=''; g('deliveryTo').value='';
  g('developerFilter').value='';
  g('freeClub').checked=false; g('freeParking').checked=false; g('hideSold').checked=false;
  g('searchInput').value=''; g('searchInputMobile').value='';
  g('searchClear').classList.remove('visible'); g('searchClearMobile').style.opacity='0';
  document.querySelectorAll('.pill').forEach(p=>p.classList.remove('active','active-green'));
  document.querySelectorAll('.pill-group .pill:first-child').forEach(p=>p.classList.add('active-green'));
  applyFilters();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WIRE UP ALL EVENT LISTENERS â€” Ø¨Ø¹Ø¯ DOM Ø§ØªØ­Ù…Ù„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  // Sidebar controls
  g('hamburgerBtn').addEventListener('click', toggleSidebar);
  g('sidebarOverlay').addEventListener('click', closeSidebar);
  g('sidebarCloseBtn').addEventListener('click', closeSidebar);
  g('resetBtn').addEventListener('click', resetFilters);

  // Search
  g('searchClear').addEventListener('click', clearSearch);
  g('searchClearMobile').addEventListener('click', clearSearchMobile);
  let searchTimer;
  g('searchInput').addEventListener('input', ()=>{ clearTimeout(searchTimer); searchTimer=setTimeout(applyFilters,200); });
  g('searchInputMobile').addEventListener('input', ()=>{ clearTimeout(searchTimer); searchTimer=setTimeout(applyFilters,200); });

  // Price sliders & inputs
  g('priceSliderMin').addEventListener('input', onPriceSliderChange);
  g('priceSliderMax').addEventListener('input', onPriceSliderChange);
  g('priceMinInput').addEventListener('input', onPriceInputChange);
  g('priceMaxInput').addEventListener('input', onPriceInputChange);

  // Area sliders & inputs
  g('areaSliderMin').addEventListener('input', onAreaSliderChange);
  g('areaSliderMax').addEventListener('input', onAreaSliderChange);
  g('areaMinInput').addEventListener('input', onAreaInputChange);
  g('areaMaxInput').addEventListener('input', onAreaInputChange);

  // PSM sliders & inputs
  g('psmSliderMin').addEventListener('input', onPsmSliderChange);
  g('psmSliderMax').addEventListener('input', onPsmSliderChange);
  g('psmMinInput').addEventListener('input', onPsmInputChange);
  g('psmMaxInput').addEventListener('input', onPsmInputChange);

  // Discount slider
  g('discountSlider').addEventListener('input', ()=>{ g('discountVal').textContent=g('discountSlider').value+'%'; applyFilters(); });

  // Toggles & select
  ['freeClub','freeParking','hideSold'].forEach(id=>g(id).addEventListener('change', applyFilters));
  g('developerFilter').addEventListener('change', applyFilters);

  // Delivery inputs
  g('deliveryFrom').addEventListener('input', ()=>{ clearDeliveryPresets(); applyFilters(); });
  g('deliveryTo').addEventListener('input', ()=>{ clearDeliveryPresets(); applyFilters(); });

  // Sort buttons
  document.querySelectorAll('.sort-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>setSort(btn.dataset.sort, btn));
  });

  // Bedrooms pills
  document.querySelectorAll('#bedroomsFilter .pill').forEach(pill=>{
    pill.addEventListener('click', ()=>filterBed(pill, pill.dataset.bed));
  });

  // Price preset chips
  document.querySelectorAll('#pricePresets .preset-chip').forEach(chip=>{
    chip.addEventListener('click', ()=>{
      const min=parseFloat(chip.dataset.priceMin), max=parseFloat(chip.dataset.priceMax);
      setPricePreset(min, max, chip.dataset.label);
    });
  });

  // Area preset chips
  document.querySelectorAll('.area-preset').forEach(chip=>{
    chip.addEventListener('click', ()=>setAreaPreset(parseFloat(chip.dataset.min), parseFloat(chip.dataset.max)));
  });

  // PSM preset chips
  document.querySelectorAll('.psm-preset').forEach(chip=>{
    chip.addEventListener('click', ()=>setPsmPreset(parseFloat(chip.dataset.min), parseFloat(chip.dataset.max)));
  });

  // Delivery preset chips
  document.querySelectorAll('.delivery-preset').forEach(chip=>{
    chip.addEventListener('click', ()=>setDelivery(chip, parseFloat(chip.dataset.from), parseFloat(chip.dataset.to)));
  });

  // Start loading data
  loadData();
});

</script>
</body>
</html>